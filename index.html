<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>王不亡 - 迴響抽取</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- 引入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0a0a1a;
            color: #e0e0e0;
            overflow: hidden;
        }
        #star-map-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            cursor: grab;
        }
        #star-map-container:active { cursor: grabbing; }
        
        .glass-panel {
            background-color: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 召喚祭壇 */
        #summon-altar {
            perspective: 1000px;
        }
        #summon-altar-ring {
            width: 150px; height: 150px;
            border: 3px solid #f59e0b;
            border-radius: 50%;
            box-shadow: 0 0 20px #f59e0b, inset 0 0 20px #f59e0b;
            animation: rotate-altar 20s linear infinite;
            transform-style: preserve-3d;
        }
        @keyframes rotate-altar {
            from { transform: rotateY(0deg) rotateX(70deg); }
            to { transform: rotateY(360deg) rotateX(70deg); }
        }

        /* 抽卡動畫 */
        .summoning #summon-altar-ring {
            animation-duration: 0.5s;
        }

        /* 歌曲卡牌 */
        .song-card {
            background: linear-gradient(45deg, #1e293b, #334155);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .collection-card {
            background: linear-gradient(45deg, #1e293b, #334155);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* 自訂滾動條 */
        .custom-scrollbar::-webkit-scrollbar { height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 10px; }
        
        /* 皇冠動畫 */
        .crown-light-modal {
            animation: pulse-modal 4s ease-in-out infinite;
        }
        @keyframes pulse-modal {
            0%, 100% { opacity: 0.7; transform: scale(0.95); }
            50% { opacity: 1; transform: scale(1.05); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- 背景 -->
    <div id="star-map-container"></div>
    
    <!-- 主要 UI -->
    <main class="fixed inset-0 p-4 flex flex-col items-center justify-between h-full">
        
        <!-- 上方：當前播放區域 -->
        <div id="now-playing-area" class="w-full max-w-sm h-1/3 flex items-center justify-center">
             <div id="card-placeholder" class="text-center text-gray-500">
                <p>點擊下方按鈕</p>
                <p>召喚第一首迴響</p>
            </div>
            <!-- 卡牌會被 JS 插入這裡 -->
        </div>

        <!-- 中間：召喚祭壇 -->
        <div id="summon-altar" class="w-full h-1/3 flex items-center justify-center">
            <div id="summon-altar-ring"></div>
        </div>

        <!-- 下方：控制與收藏區 -->
        <div class="w-full flex flex-col items-center gap-4">
            <button id="summon-btn" class="w-full max-w-sm font-bold text-xl py-4 px-6 bg-amber-500 text-gray-900 rounded-lg hover:bg-amber-400 transition-all duration-300 transform hover:scale-105 shadow-lg shadow-amber-500/30">
                召喚迴響
            </button>
             <div id="collection-area" class="w-full glass-panel rounded-lg p-2">
                <div class="flex items-center justify-center mb-2">
                    <button id="about-btn" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                        <h3 class="text-XL font-semibold text-center">專輯資訊</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div id="collection-grid" class="flex gap-2 overflow-x-auto custom-scrollbar pb-2">
                    <!-- 收藏的卡牌會被 JS 插入這裡 -->
                </div>
            </div>
        </div>

        <!-- 關於專輯 Modal -->
        <div id="about-modal" class="fixed inset-0 bg-black/70 z-50 hidden items-center justify-center p-4">
            <div class="glass-panel rounded-lg shadow-2xl max-w-2xl w-full p-6 sm:p-8 relative">
                <button id="close-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
                <div class="flex flex-col md:flex-row items-center text-center md:text-left gap-6 md:gap-8">
                    <!-- Crown Icon -->
                    <div class="w-28 h-28 md:w-32 md:h-32 flex-shrink-0">
                        <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter id="glow-modal">
                                    <feGaussianBlur stdDeviation="3.5" result="coloredBlur"></feGaussianBlur>
                                    <feMerge>
                                        <feMergeNode in="coloredBlur"></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g class="crown-light-modal" filter="url(#glow-modal)">
                                 <path d="M 20 80 L 25 40 L 40 55 L 50 30 L 60 55 L 75 40 L 80 80 Z" fill="none" stroke="#E9D5A1" stroke-width="4" stroke-linejoin="round" stroke-linecap="round"/>
                            </g>
                        </svg>
                    </div>
                     <!-- Text Info -->
                    <div>
                         <h1 class="text-4xl sm:text-5xl font-bold text-white flex items-center justify-center md:justify-start gap-x-3">
                            王不亡
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a.75.75 0 00-1.06-1.06L9 10.94l-1.72-1.72a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.06 0l3.75-3.75z" clip-rule="evenodd" />
                            </svg>
                        </h1>
                        <p class="text-xl sm:text-2xl text-gray-300 mt-1">Wang Bu-Wang</p>
                        <p class="text-base sm:text-lg text-gray-300 mt-4">一張探索存在、記憶與虛無的音樂專輯。透過聲音的紋理，我們試圖在縫隙中尋找家園，在廢鐵中看見夢想。</p>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <footer class="fixed bottom-1 w-full text-center text-gray-600 text-xs z-10 pointer-events-none">
        <p>© 2025 Wang Bu-Wang. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const songs = [
                { title: "王不亡", id: "6QqvzkZSwqUW23akhozgg6" }, { title: "地板知道", id: "7dVAbcs7Ny68KIClokYorj" },
                { title: "縫隙家園", id: "2Q3U5eEMSHH9REaxG601dk" }, { title: "廢鐵猿", id: "76enWYcfd8knUKkDFi42ze" },
                { title: "雪偏舟", id: "10hfnAE4WpkXfpIX4GVy2B" }, { title: "蝦花", id: "1gzwif6jTetRcm5CuxxIPY" },
                { title: "我像嗎", id: "2g5Y3yIRRiSootIf9c9rKA" }, { title: "Let Light In", id: "4Ci4VGTxwRkHDnnPiyOShz" },
                { title: "照完還是空", id: "5EsBs0AdGIhWFQTCswJ1pJ" }, { title: "王令開始", id: "4mRstoVpZnLJkweHPJRkbx" },
            ];

            // --- UI 元素 ---
            const nowPlayingArea = document.getElementById('now-playing-area');
            const summonBtn = document.getElementById('summon-btn');
            const collectionGrid = document.getElementById('collection-grid');
            const main = document.querySelector('main');
            const aboutBtn = document.getElementById('about-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const aboutModal = document.getElementById('about-modal');
            
            // --- 狀態管理 ---
            let availableSongs = [...songs];
            let collection = [];
            let isSummoning = false;
            
            // --- 音樂播放 ---
            function playSong(song) {
                const card = document.createElement('div');
                card.className = 'song-card rounded-lg shadow-2xl w-full max-w-sm p-4';
                card.style.transform = 'rotateY(180deg) scale(0.5)';
                card.innerHTML = `
                    <p class="text-2xl font-bold">${song.title}</p>
                    <div class="mt-2 h-[80px] w-full">
                        <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${song.id}?utm_source=generator&theme=0&autoplay=1" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                    </div>
                `;
                nowPlayingArea.innerHTML = '';
                nowPlayingArea.appendChild(card);
                
                // 卡牌翻轉動畫
                setTimeout(() => {
                    card.style.transform = 'rotateY(0deg) scale(1)';
                }, 100);
            }

            // --- 召喚邏輯 ---
            summonBtn.addEventListener('click', () => {
                if (isSummoning) return;
                isSummoning = true;
                
                if (availableSongs.length === 0) {
                     summonBtn.textContent = "再次召喚";
                     availableSongs = [...songs]; // 重置卡池
                     collection = [];
                     collectionGrid.innerHTML = '';
                }

                const randomIndex = Math.floor(Math.random() * availableSongs.length);
                const summonedSong = availableSongs.splice(randomIndex, 1)[0];
                collection.push(summonedSong);
                
                // 觸發動畫
                document.getElementById('card-placeholder')?.remove();
                main.classList.add('summoning');
                triggerSummonEffect(); // 觸發背景特效

                setTimeout(() => {
                    playSong(summonedSong);
                    updateCollection();
                    main.classList.remove('summoning');
                    isSummoning = false;
                }, 1000); // 動畫持續時間
            });
            
            // --- 更新收藏庫 UI ---
            function updateCollection() {
                collectionGrid.innerHTML = '';
                collection.forEach(song => {
                    const card = document.createElement('div');
                    card.className = 'collection-card rounded p-2 text-center w-20 h-20 flex-shrink-0 flex flex-col justify-center cursor-pointer';
                    card.innerHTML = `<p class="text-xs font-bold leading-tight">${song.title}</p>`;
                    card.addEventListener('click', () => playSong(song));
                    collectionGrid.appendChild(card);
                });
                collectionGrid.scrollLeft = collectionGrid.scrollWidth;
            }
            
            // --- Modal 邏輯 ---
            aboutBtn.addEventListener('click', () => {
                aboutModal.classList.remove('hidden');
                aboutModal.classList.add('flex');
            });
            closeModalBtn.addEventListener('click', () => {
                aboutModal.classList.add('hidden');
                aboutModal.classList.remove('flex');
            });
            aboutModal.addEventListener('click', (e) => {
                if (e.target === aboutModal) {
                    aboutModal.classList.add('hidden');
                    aboutModal.classList.remove('flex');
                }
            });

            // --- Three.js 背景 ---
            const bgContainer = document.getElementById('star-map-container');
            let scene, camera, renderer, particles, mouseX = 0, mouseY = 0, isMouseDown = false;
            let shockwave;
            
            function initBg() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 4000);
                camera.position.z = 1000;
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                bgContainer.appendChild(renderer.domElement);
                
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                for (let i = 0; i < 15000; i++) vertices.push(Math.random() * 3000 - 1500, Math.random() * 3000 - 1500, Math.random() * 3000 - 1500);
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                particles = new THREE.Points(geometry, new THREE.PointsMaterial({ size: 1.5, color: 0xaaaaaa, transparent: true, opacity: 0.7 }));
                scene.add(particles);

                // 衝擊波
                const shockwaveGeo = new THREE.RingGeometry(0.1, 1, 64);
                const shockwaveMat = new THREE.MeshBasicMaterial({ color: 0xf59e0b, transparent: true, opacity: 0 });
                shockwave = new THREE.Mesh(shockwaveGeo, shockwaveMat);
                shockwave.lookAt(new THREE.Vector3(0,0,1));
                scene.add(shockwave);

                bgContainer.addEventListener('pointerdown', () => { isMouseDown = true; });
                bgContainer.addEventListener('pointerup', () => { isMouseDown = false; });
                bgContainer.addEventListener('pointermove', (e) => {
                    if (isMouseDown) {
                        mouseX = e.clientX - window.innerWidth / 2;
                        mouseY = e.clientY - window.innerHeight / 2;
                    }
                });
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            function triggerSummonEffect() {
                shockwave.scale.set(1,1,1);
                shockwave.material.opacity = 1;
            }

            function animateBg() {
                requestAnimationFrame(animateBg);
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                camera.position.y += (-mouseY - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
                particles.rotation.y += 0.0002;
                
                // 衝擊波動畫
                if (shockwave.material.opacity > 0) {
                    shockwave.scale.x *= 1.05;
                    shockwave.scale.y *= 1.05;
                    shockwave.material.opacity -= 0.02;
                }
                
                renderer.render(scene, camera);
            }
            
            initBg();
            animateBg();
        });
    </script>
</body>
</html>

